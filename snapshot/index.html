<!DOCTYPE html>
<html lang="">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="author" content="Álvaro Sánchez-Mariscal Arnaiz">
<title>Spring Security REST for Grails</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Spring Security REST for Grails</h1>
<div class="details">
<span id="author" class="author">Álvaro Sánchez-Mariscal Arnaiz</span><br>
<span id="email" class="email"><a href="mailto:alvaro.sanchezmariscal@gmail.com">alvaro.sanchezmariscal@gmail.com</a></span><br>
<span id="revnumber">version 6.0.0-SNAPSHOT</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction_to_the_spring_security_rest_plugin">1. Introduction to the Spring Security REST plugin</a>
<ul class="sectlevel2">
<li><a href="#_motivation">1.1. Motivation</a></li>
<li><a href="#_release_history">1.2. Release History</a></li>
</ul>
</li>
<li><a href="#_whats_new_in_6_0">2. What&#8217;s new in 6.0?</a></li>
<li><a href="#_whats_new_in_5_0">3. What&#8217;s new in 5.0?</a>
<ul class="sectlevel2">
<li><a href="#_grails_6_support">3.1. Grails 6 support</a></li>
<li><a href="#_provide_accesstoken_object_to_storetoken_and_removetoken_methods">3.2. Provide AccessToken object to storeToken and removeToken Methods</a></li>
<li><a href="#_minimum_java_version">3.3. Minimum Java Version</a></li>
<li><a href="#_dependency_updates">3.4. Dependency updates</a></li>
</ul>
</li>
<li><a href="#_whats_new_in_2_0">4. What&#8217;s new in 2.0?</a>
<ul class="sectlevel2">
<li><a href="#_grails_3_and_4_support">4.1. Grails 3 and 4 support</a></li>
<li><a href="#_plugin_broken_down_into_multiple_modules">4.2. Plugin broken down into multiple modules</a></li>
<li><a href="#_cors_is_now_supported_in_grails_core">4.3. CORS is now supported in Grails core</a></li>
<li><a href="#_jwt_improvements">4.4. JWT improvements</a></li>
<li><a href="#_other_minor_updates">4.5. Other minor updates</a></li>
</ul>
</li>
<li><a href="#_whats_new_in_1_5">5. What&#8217;s new in 1.5?</a>
<ul class="sectlevel2">
<li><a href="#_jwt_support">5.1. JWT support</a></li>
<li><a href="#_redis_support">5.2. Redis support</a></li>
<li><a href="#_new_package_base">5.3. New package base</a></li>
<li><a href="#_other_minor_changes">5.4. Other minor changes</a></li>
</ul>
</li>
<li><a href="#_whats_new_in_1_4">6. What&#8217;s new in 1.4?</a>
<ul class="sectlevel2">
<li><a href="#_full_compatibility_with_spring_security_core">6.1. Full compatibility with Spring Security core.</a></li>
<li><a href="#_rfc_6750_bearer_token_support_by_default">6.2. RFC 6750 Bearer Token support by default</a></li>
<li><a href="#_credentials_are_extracted_from_json_by_default">6.3. Credentials are extracted from JSON by default</a></li>
<li><a href="#_anonymous_access_is_allowed">6.4. Anonymous access is allowed</a></li>
<li><a href="#_other_minor_changes_2">6.5. Other minor changes</a></li>
</ul>
</li>
<li><a href="#_articles_and_sample_projects">7. Articles and sample projects</a>
<ul class="sectlevel2">
<li><a href="#_articles">7.1. Articles</a></li>
<li><a href="#_sample_projects">7.2. Sample projects</a></li>
</ul>
</li>
<li><a href="#configuration">8. Configuration</a>
<ul class="sectlevel2">
<li><a href="#_installing_the_plugin">8.1. Installing the plugin</a></li>
<li><a href="#_plugin_configuration">8.2. Plugin configuration</a></li>
</ul>
</li>
<li><a href="#events">9. Events</a>
<ul class="sectlevel2">
<li><a href="#_event_notification">9.1. Event Notification</a></li>
<li><a href="#_registering_an_event_listener">9.2. Registering an Event Listener</a></li>
<li><a href="#_registering_callback_closures">9.3. Registering Callback Closures</a></li>
</ul>
</li>
<li><a href="#authentication">10. Authentication Endpoint</a>
<ul class="sectlevel2">
<li><a href="#_extracting_credentials_from_the_request">10.1. Extracting credentials from the request</a></li>
<li><a href="#_logout">10.2. Logout</a></li>
</ul>
</li>
<li><a href="#tokenGeneration">11. Token Generation</a>
<ul class="sectlevel2">
<li><a href="#_jwt">11.1. JWT</a></li>
<li><a href="#_memcached_gorm_redis_grails_cache">11.2. Memcached, GORM, Redis, Grails Cache</a></li>
</ul>
</li>
<li><a href="#tokenStorage">12. Token Storage</a>
<ul class="sectlevel2">
<li><a href="#_json_web_token">12.1. JSON Web Token</a></li>
<li><a href="#_memcached">12.2. Memcached</a></li>
<li><a href="#_gorm">12.3. GORM</a></li>
<li><a href="#_redis">12.4. Redis</a></li>
<li><a href="#_grails_cache">12.5. Grails Cache</a></li>
</ul>
</li>
<li><a href="#tokenRendering">13. Token Rendering</a>
<ul class="sectlevel2">
<li><a href="#_disabling_bearer_tokens_support_for_full_response_customisation">13.1. Disabling bearer tokens support for full response customisation</a></li>
</ul>
</li>
<li><a href="#tokenValidation">14. Token Validation Filter</a>
<ul class="sectlevel2">
<li><a href="#_sending_tokens_in_the_request">14.1. Sending tokens in the request</a></li>
<li><a href="#_anonymous_access">14.2. Anonymous access</a></li>
<li><a href="#_validation_endpoint">14.3. Validation Endpoint</a></li>
</ul>
</li>
<li><a href="#cors">15. CORS support</a></li>
<li><a href="#oauth">16. Delegating authentication to OAuth providers</a>
<ul class="sectlevel2">
<li><a href="#_google">16.1. Google</a></li>
</ul>
</li>
<li><a href="#debugging">17. Debugging</a></li>
<li><a href="#faq">18. Frequently Asked Questions</a>
<ul class="sectlevel2">
<li><a href="#_why_this_token_based_implementation_cant_i_use_http_basic_authentication">18.1. Why this token-based implementation? Can&#8217;t I use HTTP basic authentication?</a></li>
<li><a href="#_why_cant_the_api_be_secured_with_oauth">18.2. Why can&#8217;t the API be secured with OAuth?</a></li>
<li><a href="#_why_you_didnt_use_any_of_the_existing_oauth_plugins_why_pac4j">18.3. Why you didn&#8217;t use any of the existing OAuth plugins? Why pac4j?</a></li>
<li><a href="#_project_history">18.4. Project History</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Version: 6.0.0-SNAPSHOT</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_to_the_spring_security_rest_plugin">1. Introduction to the Spring Security REST plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Security REST Grails plugin allows you to use Spring Security for a stateless, token-based, RESTful authentication.</p>
</div>
<div class="paragraph">
<p>Versions <code>1.x.</code> of the plugin are compatible with Grails 2, whereas versions <code>2.x</code> are to be used with Grails 3.</p>
</div>
<div class="sect2">
<h3 id="_motivation">1.1. Motivation</h3>
<div class="paragraph">
<p>The default behaviour of Spring Security is to store the authenticated principal in the HTTP session. However, in a
RESTful scenario, we need to make sure our server is stateless.</p>
</div>
<div class="paragraph">
<p>The typical flow could be the following:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/rest.png" alt="rest">
</div>
<div class="title">Figure 1. Sequence diagram overview of the plugin behavior</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client application requests and endpoint that requires authentication, so the server responds with a 401 response.</p>
</li>
<li>
<p>The client redirects the user to the login form.</p>
</li>
<li>
<p>The user enter credentials, and the client sends a request to the authentication endpoint. The server validates credentials, and if valid, generates, stores and sends back a token to the client.</p>
</li>
<li>
<p>The client then stores the token internally. It will be sent on every API method request.</p>
</li>
<li>
<p>The client sends again a request to the protected resource, passing the token as an HTTP header.</p>
</li>
<li>
<p>The server validates the token, and if valid, executes the actual operation requested.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As per the <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">REST definition</a>, the client is transferring its
state on every request so the server is truly stateless.</p>
</div>
<div class="paragraph">
<p>This plugin helps you to wire your existing Spring Security authentication mechanism, provides you
with ready-to-use token generation strategies and comes prepackaged with JWT, Memcached, GORM, Redis
and Grails Cache support for token storage.</p>
</div>
</div>
<div class="sect2">
<h3 id="_release_history">1.2. Release History</h3>
<div class="paragraph">
<p>You can view all releases at <a href="https://github.com/grails/grails-spring-security-rest/releases" class="bare">https://github.com/grails/grails-spring-security-rest/releases</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>29 August 2016</p>
<div class="ulist">
<ul>
<li>
<p>1.5.4</p>
</li>
</ul>
</div>
</li>
<li>
<p>7 January 2016</p>
<div class="ulist">
<ul>
<li>
<p>2.0.0.M2</p>
</li>
</ul>
</div>
</li>
<li>
<p>11 December 2015</p>
<div class="ulist">
<ul>
<li>
<p>2.0.0.M1</p>
</li>
</ul>
</div>
</li>
<li>
<p>20 November 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.3</p>
</li>
</ul>
</div>
</li>
<li>
<p>19 August 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.2</p>
</li>
</ul>
</div>
</li>
<li>
<p>6 May 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.1</p>
</li>
</ul>
</div>
</li>
<li>
<p>6 May 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0</p>
</li>
</ul>
</div>
</li>
<li>
<p>21 April 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0.RC4</p>
</li>
</ul>
</div>
</li>
<li>
<p>13 April 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0.RC3</p>
</li>
</ul>
</div>
</li>
<li>
<p>9 April 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0.RC2</p>
</li>
</ul>
</div>
</li>
<li>
<p>2 April 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0.RC1</p>
</li>
</ul>
</div>
</li>
<li>
<p>1 April 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0.M3</p>
</li>
</ul>
</div>
</li>
<li>
<p>24 February 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0.M2</p>
</li>
</ul>
</div>
</li>
<li>
<p>3 February 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.5.0.M1</p>
</li>
</ul>
</div>
</li>
<li>
<p>28 January 2015</p>
<div class="ulist">
<ul>
<li>
<p>1.4.1</p>
</li>
</ul>
</div>
</li>
<li>
<p>12 November 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.1.RC2</p>
</li>
</ul>
</div>
</li>
<li>
<p>20 October 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.1.RC1</p>
</li>
</ul>
</div>
</li>
<li>
<p>12 August 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0</p>
</li>
</ul>
</div>
</li>
<li>
<p>14 July 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.RC5</p>
</li>
</ul>
</div>
</li>
<li>
<p>4 July 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.RC4</p>
</li>
</ul>
</div>
</li>
<li>
<p>24 June 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.RC3</p>
</li>
</ul>
</div>
</li>
<li>
<p>24 June 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.RC2</p>
</li>
</ul>
</div>
</li>
<li>
<p>20 June 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.RC1</p>
</li>
</ul>
</div>
</li>
<li>
<p>11 June 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.M3</p>
</li>
</ul>
</div>
</li>
<li>
<p>1 June 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.M2</p>
</li>
</ul>
</div>
</li>
<li>
<p>29 May 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.4.0.M1</p>
</li>
</ul>
</div>
</li>
<li>
<p>23 April 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.3.4</p>
</li>
</ul>
</div>
</li>
<li>
<p>16 April 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.3.3</p>
</li>
</ul>
</div>
</li>
<li>
<p>3 April 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.3.2</p>
</li>
</ul>
</div>
</li>
<li>
<p>18 March 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.3.1</p>
</li>
</ul>
</div>
</li>
<li>
<p>4 March 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.3.0</p>
</li>
</ul>
</div>
</li>
<li>
<p>17 February 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.2.5</p>
</li>
</ul>
</div>
</li>
<li>
<p>10 February 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.2.4</p>
</li>
</ul>
</div>
</li>
<li>
<p>4 February 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.2.3</p>
</li>
</ul>
</div>
</li>
<li>
<p>31 January 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.2.2</p>
</li>
</ul>
</div>
</li>
<li>
<p>15 January 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.2.0</p>
</li>
</ul>
</div>
</li>
<li>
<p>14 January 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.1.0</p>
</li>
</ul>
</div>
</li>
<li>
<p>13 January 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.0.1</p>
</li>
</ul>
</div>
</li>
<li>
<p>12 January 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.0.0</p>
</li>
</ul>
</div>
</li>
<li>
<p>10 January 2014</p>
<div class="ulist">
<ul>
<li>
<p>1.0.0.RC2</p>
</li>
</ul>
</div>
</li>
<li>
<p>31 December 2013</p>
<div class="ulist">
<ul>
<li>
<p>Initial 1.0.0.RC1 release.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_new_in_6_0">2. What&#8217;s new in 6.0?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>include:src/docs/whatsNew60.adoc[]</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_new_in_5_0">3. What&#8217;s new in 5.0?</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_grails_6_support">3.1. Grails 6 support</h3>
<div class="paragraph">
<p>This major release is working with Grails 6. It&#8217;s based on the newer versions of Spring Security Core plugin,
which in turn uses newer Spring Security versions, so make sure you read carefully what the new versions have changed:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Grails Version</th>
<th class="tableblock halign-left valign-top"><code>spring-security-rest</code> version</th>
<th class="tableblock halign-left valign-top">Spring Security Core docs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6.0.0.RC1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://grails-plugins.github.io/grails-spring-security-core/6.0.x/index.html#whatsNew" class="bare">https://grails-plugins.github.io/grails-spring-security-core/6.0.x/index.html#whatsNew</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_provide_accesstoken_object_to_storetoken_and_removetoken_methods">3.2. Provide AccessToken object to storeToken and removeToken Methods</h3>
<div class="paragraph">
<p>See issue <a href="https://github.com/grails/grails-spring-security-rest/issues/437">#437</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_minimum_java_version">3.3. Minimum Java Version</h3>
<div class="paragraph">
<p>The minimum java version is now 11.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dependency_updates">3.4. Dependency updates</h3>
<div class="paragraph">
<p>Dependencies are updated as of Grails 6.1.1 release date.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_new_in_2_0">4. What&#8217;s new in 2.0?</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_grails_3_and_4_support">4.1. Grails 3 and 4 support</h3>
<div class="paragraph">
<p>This major release is working with Grails 3 and 4. It&#8217;s based on the newer versions of Spring Security Core plugin,
which in turn uses newer Spring Security versions, so make sure you read carefully what the new versions have changed:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Grails Version</th>
<th class="tableblock halign-left valign-top"><code>spring-security-rest</code> version</th>
<th class="tableblock halign-left valign-top">Spring Security Core docs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.0.0.RC1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://grails-plugins.github.io/grails-spring-security-core/3.2.x/index.html#newInV3" class="bare">https://grails-plugins.github.io/grails-spring-security-core/3.2.x/index.html#newInV3</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3.0.0.RC1</code> or later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://grails-plugins.github.io/grails-spring-security-core/4.0.x/index.html#newInV3" class="bare">https://grails-plugins.github.io/grails-spring-security-core/4.0.x/index.html#newInV3</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Special thanks to <a href="https://github.com/Schlogen">James Kleeh</a>  and
<a href="https://github.com/rvanderwerf">Ryan Vanderwerf</a> for their help in the upgrade steps.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plugin_broken_down_into_multiple_modules">4.2. Plugin broken down into multiple modules</h3>
<div class="paragraph">
<p>Starting from this version, <code>org.grails.plugins:spring-security-rest</code> just contains support for JWT. Artifact size has
been reduced from 429 KB in version 1.5.3 to 194K in 2.0.x!</p>
</div>
<div class="paragraph">
<p>For those using a different token storage system, the following artifacts are also published:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.grails.plugins:spring-security-rest-gorm</code>.</p>
</li>
<li>
<p><code>org.grails.plugins:spring-security-rest-grailscache</code>.</p>
</li>
<li>
<p><code>org.grails.plugins:spring-security-rest-memcached</code>.</p>
</li>
<li>
<p><code>org.grails.plugins:spring-security-rest-redis</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The version is the same in all modules. For more details, check the <a href="#configuration">Configuration</a> section.</p>
</div>
<div class="paragraph">
<p>As a consequence, configuration properties like <code>grails.plugin.springsecurity.rest.token.storage.useMemcached</code> are no
longer used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cors_is_now_supported_in_grails_core">4.3. CORS is now supported in Grails core</h3>
<div class="paragraph">
<p>As of Grails 3.2.1, Grails natively supports CORS. Refer to the <a href="http://docs.grails.org/3.2.0/">Grails documentation</a> for
more information about how to configure it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jwt_improvements">4.4. JWT improvements</h3>
<div class="paragraph">
<p>As of this version, there is no longer a default value for the configuration property
<code>grails.plugin.springsecurity.rest.token.storage.jwt.secret</code>. Furthermore, if you are using JWT and no value has
been provided for that configuration property, an exception will be thrown during application startup.</p>
</div>
<div class="paragraph">
<p>It is also possible to influence the JWT generation by providing additional claims. Finally, the signing / encryption
algorithms used are configurable. Check the <a href="#tokenGeneration">Token Generation</a> section for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_other_minor_updates">4.5. Other minor updates</h3>
<div class="ulist">
<ul>
<li>
<p>Classes have been annotated with <code>@CompileStatic</code>, for performance reasons.</p>
</li>
<li>
<p>Documentation has been migrated to Asciidoctor.</p>
</li>
<li>
<p>All libraries used have been upgraded to their latest versions.</p>
</li>
<li>
<p>Snapshots are now published automatically to <a href="https://oss.jfrog.org">Artifactory OSS</a> on every successful build. You can
use them by defining this Maven repository inside the <code>repositories</code> block in your <code>build.gradle</code>:</p>
<div class="literalblock">
<div class="content">
<pre>maven { url "https://oss.jfrog.org/artifactory/oss-snapshot-local" }</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_new_in_1_5">5. What&#8217;s new in 1.5?</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_jwt_support">5.1. JWT support</h3>
<div class="paragraph">
<p>JWT is fully supported and is now the default token "storage" mechanism. If you still want to use your previous storage
(such as Memcached or GORM), make sure you explicitly set to <code>true</code> one of the following properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. New configuration values in 1.5</caption>
<colgroup>
<col style="width: 80%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Config key</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.useMemcached</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.useGorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.useGrailsCache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If switching over JWT, the logout behavior is not available anymore. Read the documentation on how to
implement your own logout strategy if you want to.</p>
</div>
</div>
<div class="sect2">
<h3 id="_redis_support">5.2. Redis support</h3>
<div class="paragraph">
<p>Redis can now be used as token storage service. Thanks to <a href="https://github.com/peh">Philipp Eschenbach</a> for
his initial contribution.</p>
</div>
</div>
<div class="sect2">
<h3 id="_new_package_base">5.3. New package base</h3>
<div class="paragraph">
<p>Packages <code>com.odobo.grails.plugin.springsecurity.rest.*</code> have been refactored to simply <code>grails.plugin.springsecurity.rest.*</code>.
Make sure to double-check your imports when upgrading to 1.5.</p>
</div>
</div>
<div class="sect2">
<h3 id="_other_minor_changes">5.4. Other minor changes</h3>
<div class="ulist">
<ul>
<li>
<p>The plugin now uses Grails 2.4.4, and the build and tests are executed with Java 8.</p>
</li>
<li>
<p>Documentation for older versions is now published at <a href="http://alvarosanchez.github.io/grails-spring-security-rest" class="bare">http://alvarosanchez.github.io/grails-spring-security-rest</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_new_in_1_4">6. What&#8217;s new in 1.4?</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_full_compatibility_with_spring_security_core">6.1. Full compatibility with Spring Security core.</h3>
<div class="paragraph">
<p>Up to previous releases, this plugin was overriding "stateful" Spring Security core beans, to ensure a stateless behaviour.
After some users reported issues integrating this plugin with existing installations, version 1.4 now follows a more
friendly approach.</p>
</div>
<div class="paragraph">
<p>A new chapter has been created explaining how to configure the filter chains appropriately.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rfc_6750_bearer_token_support_by_default">6.2. RFC 6750 Bearer Token support by default</h3>
<div class="paragraph">
<p>Now, the token validation and rendering aligns with the <a href="http://tools.ietf.org/html/rfc6750">RFC 6750 Bearer Token</a> spec.
If you want to keep the old behaviour, simply disable it by setting
<code>grails.plugin.springsecurity.rest.token.validation.useBearerToken = false</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_credentials_are_extracted_from_json_by_default">6.3. Credentials are extracted from JSON by default</h3>
<div class="paragraph">
<p>It makes more sense in a REST application. The old behaviour can still be used by using the corresponding configuration
property.</p>
</div>
</div>
<div class="sect2">
<h3 id="_anonymous_access_is_allowed">6.4. Anonymous access is allowed</h3>
<div class="paragraph">
<p>In case you want to enable anonymous access (read: not authenticated) to certain URL patterns, you can do so. Take a
look at the [new chapter in the documentation|guide:tokenValidation].</p>
</div>
</div>
<div class="sect2">
<h3 id="_other_minor_changes_2">6.5. Other minor changes</h3>
<div class="ulist">
<ul>
<li>
<p>Upgraded dependencies:</p>
<div class="ulist">
<ul>
<li>
<p><code>spring-security-core:2.0-RC3</code>.</p>
</li>
<li>
<p><code>cors:1.1.6</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_articles_and_sample_projects">7. Articles and sample projects</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_articles">7.1. Articles</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://giri-tech.blogspot.com/2016/06/create-secured-restful-api-app-with.html">Create a Secured Restful API App with Grails 3, PostgreSQL and JMS - Step by Step: Part 2 of 5</a>. June 2016.</p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/library/mo-build-a-hybrid-mobile-app-ionic-grails-bluemix-trs/index.html">Build a hybrid mobile app with Ionic, Grails, and Bluemix</a>. May 2016.</p>
</li>
<li>
<p><a href="https://www.inshikos.com/blogs/80/dev/cors-enabled-rest-api-on-grails-for-cordova-apps-using-jwt-auth-tokens">CORS Enabled REST API on Grails for Cordova Apps using JWT Auth Tokens</a>. February 2016.</p>
</li>
<li>
<p><a href="http://sergiodelamo.es/how-to-secure-your-grails-3-api-with-spring-security-rest-for-grails/">How to secure your Grails 3 API with Spring Security REST for Grails?</a>.</p>
</li>
<li>
<p><a href="http://hantsy.blogspot.com.es/2014/10/the-final-mile-upgrade-to-grails-243.html">The final mile: Upgrade to Grails 2.4.3 and use Spring Security REST plugin</a>. October 2014.</p>
</li>
<li>
<p><a href="http://www.oodlestechnologies.com/blogs/Spring-Security-Rest-configuration-to-create-anonymous-accessible-URI&#8217;s">Spring Security Rest configuration to create anonymous accessible URI&#8217;s</a>. September 2014</p>
</li>
<li>
<p><a href="https://asoftwareguy.com/2014/03/17/using-grails-rest-for-authentication-in-an-angularjs-spa/">Using Grails REST for authentication in an AngularJS SPA</a>. March 2014.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample_projects">7.2. Sample projects</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/sdelamo/groovy-client-grails-spring-security-rest">Groovy client</a>.</p>
</li>
<li>
<p><a href="https://github.com/dmahapatro/grails-spring-security-rest-sample">Sample Grails 2.x app using plugin v1.3.0</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration">8. Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installing_the_plugin">8.1. Installing the plugin</h3>
<div class="paragraph">
<p>Just proceed as with any other Grails 3 plugin:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.gradle</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {

    <span class="comment">//Other dependencies</span>

    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:spring-security-rest:6.0.0-SNAPSHOT</span><span class="delimiter">&quot;</span></span>

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the default token storage system is JWT. If you want a different one, you need to install an additional
artifact. For instance, for Memcached:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.gradle</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext.springSecurityRestVersion = <span class="string"><span class="delimiter">'</span><span class="content">6.0.0-SNAPSHOT</span><span class="delimiter">'</span></span>

dependencies {

    <span class="comment">//Other dependencies</span>

    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:spring-security-rest:</span><span class="inline"><span class="inline-delimiter">${</span>springSecurityRestVersion<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:spring-security-rest-memcached:</span><span class="inline"><span class="inline-delimiter">${</span>springSecurityRestVersion<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Maven coordinates are the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Grails Cache: <code>org.grails.plugins:spring-security-rest-grailscache</code>.</p>
</li>
<li>
<p>Memcached: <code>org.grails.plugins:spring-security-rest-memcached</code>.</p>
</li>
<li>
<p>GORM: <code>org.grails.plugins:spring-security-rest-gorm</code>.</p>
</li>
<li>
<p>Redis: <code>org.grails.plugins:spring-security-rest-redis</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that configuration properties such as <code>grails.plugin.springsecurity.rest.token.storage.useMemcached</code> are no longer
used. Every submodule of the above list will automatically configure the token store appropriately</p>
</div>
<div class="paragraph">
<p>If you want your own token storage system, you need to implement
<a href="https://grails-plugins.github.io/grails-spring-security-rest/6.0.0-SNAPSHOT/docs/gapi/grails/plugin/springsecurity/rest/token/storage/TokenStorageService.html">role=include</a>
and register it in <code>resources.groovy</code> as <code>tokenStorageService</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plugin_configuration">8.2. Plugin configuration</h3>
<div class="paragraph">
<p>This plugin is compatible by default with Spring Security core traditional, form-based authentication. The important thing
to remember is: you have to separate the filter chains, so different filters are applied on each case.</p>
</div>
<div class="paragraph">
<p>The stateless, token-based approach of this plugin is incompatible with the HTTP session-based approach of Spring Security,
core, so the trick is to identify what URL patterns have to be stateless, and what others have to be stateful (if any).</p>
</div>
<div class="paragraph">
<p>To configure the chains properly, you can use the <code>grails.plugin.springsecurity.filterChain.chainMap</code> property:</p>
</div>
<div class="listingblock">
<div class="title">Listing 1. <code>grails.plugin.springsecurity.filterChain.chainMap</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.plugin.springsecurity.filterChain.chainMap = [
        <span class="comment">//Stateless chain</span>
        [
                <span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/**</span><span class="delimiter">'</span></span>,
                <span class="key">filters</span>: <span class="string"><span class="delimiter">'</span><span class="content">JOINED_FILTERS,-anonymousAuthenticationFilter,-exceptionTranslationFilter,-authenticationProcessingFilter,-securityContextPersistenceFilter,-rememberMeAuthenticationFilter</span><span class="delimiter">'</span></span>
        ],

        <span class="comment">//Traditional, stateful chain</span>
        [
                <span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/stateful/**</span><span class="delimiter">'</span></span>,
                <span class="key">filters</span>: <span class="string"><span class="delimiter">'</span><span class="content">JOINED_FILTERS,-restTokenValidationFilter,-restExceptionTranslationFilter</span><span class="delimiter">'</span></span>
        ]
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>To understand this syntax, please read the
<a href="https://grails-plugins.github.io/grails-spring-security-core/v3/index.html#filters">Spring Security Core documentation</a>.
Long story short: <code>JOINED_FILTERS</code> refers to all the configured filters. The minus (<code>-</code>) notation means all the previous values
but the neglected one.</p>
</div>
<div class="paragraph">
<p>So the first chain applies all the filters except the stateful ones. The second one applies all the filters but the stateless ones.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure that the stateless chain applies not only to your REST controllers, but also to the URL&#8217;s where this plugin
filters are listening: by default, <code>/api/login</code> for authentication, <code>/api/logout</code> for
logout and <code>/api/validate</code> for token validation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The difference is that, in a traditional form-based authentication, Spring Security will respond with an HTTP 302 redirect
to the login controller. That doesn&#8217;t work for an API, so in the stateless approach, an HTTP 401 response will be sent back.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="events">9. Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Security Rest plugin fires events exactly like Spring Security Core does.</p>
</div>
<div class="sect2">
<h3 id="_event_notification">9.1. Event Notification</h3>
<div class="paragraph">
<p>You can set up event notifications in two ways. The sections that follow describe each approach in more detail.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Register an event listener, ignoring events that do not interest you. Spring allows only partial event subscription;
you use generics to register the class of events that interest you, and you are notified of that class and all subclasses.</p>
</li>
<li>
<p>Register one or more callback closures in <code>grails-app/conf/application.groovy</code> that take advantage of the plugin&#8217;s
<code>grails.plugin.springsecurity.rest.RestSecurityEventListener</code>. The listener does the filtering for you.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_authenticationeventpublisher">9.1.1. AuthenticationEventPublisher</h4>
<div class="paragraph">
<p>Spring Security REST publishes events using an
<a href="http://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/AuthenticationEventPublisher.html">AuthenticationEventPublisher</a>
which in turn fire events using the
<a href="http://docs.spring.io/spring/docs/4.0.x/javadoc-api/org/springframework/context/ApplicationEventPublisher.html">ApplicationEventPublisher</a>.
By default no events are fired since the <code>AuthenticationEventPublisher</code> instance registered is a
<code>grails.plugin.springsecurity.rest.authentication.NullRestAuthenticationEventPublisher</code>. But you can enable event
publishing by setting <code>grails.plugin.springsecurity.useSecurityEventListener = true</code> in <code>grails-app/conf/application.[groovy|yml]</code>.</p>
</div>
<div class="paragraph">
<p>You can use the <code>useSecurityEventListener</code> setting to temporarily disable and enable the callbacks, or enable them
per-environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="_token_creation">9.1.2. Token Creation</h4>
<div class="paragraph">
<p>Currently the Spring Security REST plugin supports a single event in addition to the default spring security events.
The event is fired whenever a new token is created. See <code>grails.plugin.springsecurity.rest.RestTokenCreationEvent</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Every time a token is successfully submitted, an <code>AuthenticationSuccessEvent</code> will be fired.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_registering_an_event_listener">9.2. Registering an Event Listener</h3>
<div class="paragraph">
<p>Enable events with <code>grails.plugin.springsecurity.useSecurityEventListener = true</code> and create one or more Groovy or Java
classes, for example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. Custom event listener</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.foo.bar

<span class="keyword">import</span> <span class="include">org.springframework.context.ApplicationListener</span>
<span class="keyword">import</span> <span class="include">grails.plugin.springsecurity.rest.RestTokenCreationEvent</span>

<span class="type">class</span> <span class="class">MySecurityEventListener</span>
      <span class="directive">implements</span> ApplicationListener&lt;RestTokenCreationEvent&gt; {

   <span class="type">void</span> onApplicationEvent(RestTokenCreationEvent event) {
      <span class="comment">// The access token is a delegate of the event, so you have access to an instance of `grails.plugin.springsecurity.rest.token.AccessToken`</span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Register the class in <code>grails-app/conf/spring/resources.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 3. Event listener registration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">com.foo.bar.MySecurityEventListener</span>

beans = {
   mySecurityEventListener(MySecurityEventListener)
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_registering_callback_closures">9.3. Registering Callback Closures</h3>
<div class="paragraph">
<p>Alternatively, enable events with <code>grails.plugin.springsecurity.useSecurityEventListener = true</code> and register one or
more callback closure(s) in <code>grails-app/conf/Config.groovy</code> and let <code>SecurityEventListener</code> do the filtering.</p>
</div>
<div class="paragraph">
<p>Implement the event handlers that you need, for example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. Callback closures</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.plugin.springsecurity.useSecurityEventListener = <span class="predefined-constant">true</span>

grails.plugin.springsecurity.onRestTokenCreationEvent = { e, appCtx -&gt;
   <span class="comment">// handle RestTokenCreationEvent</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>None of these closures are required; if none are configured, nothing will be called. Just implement the event handlers
that you need.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authentication">10. Authentication Endpoint</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://grails-plugins.github.io/grails-spring-security-rest/6.0.0-SNAPSHOT/docs/gapi/grails/plugin/springsecurity/rest/RestAuthenticationFilter.html">authentication filter</a>
uses the default <code>authenticationManager</code> bean, which in turn uses all the registered authentication
providers. See the <a href="https://grails-plugins.github.io/grails-spring-security-core/v3/index.html#authenticationProviders">Spring Security Core guide</a>
for more information about how to define your own providers. Note that you can easily plug any Spring Security sub-plugin
(like the LDAP one) to use a different authentication strategy.</p>
</div>
<div class="paragraph">
<p>If the authentication is successful, a token generator is used to generate a token, and a
token storage implementation is used to store the token. Finally, the JSON response sent back to the
client is rendered by a <code>restAuthenticationTokenJsonRenderer</code> bean. See the token rendering documentation for more details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This authentication filter will only be applied to the above configured URL and can also be disabled, in case a different approach
for token creation is followed. In the rest of the cases, the request will continue through the filter chain, reaching Spring Security
Core filters. Bear in mind that, by default, Spring Security Core 2.x locks down all URL&#8217;s unless a explicit securiy rule has been
specified for each of them.</p>
</div>
<div class="paragraph">
<p>See <a href="https://grails-plugins.github.io/grails-spring-security-core/v3/index.html#requestMappings">Spring Security Core documentation</a>
for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following are the configuration properties available:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Authentication configuration options</caption>
<colgroup>
<col style="width: 80%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.active</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.endpointUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/api/login</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.failureStatusCode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>401</code></p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_extracting_credentials_from_the_request">10.1. Extracting credentials from the request</h3>
<div class="paragraph">
<p>The plugin supports 2 ways of extracting the username and password: using request parameters, and using a JSON payload.
To align with the RESTful principles, JSON payload is the default behaviour.</p>
</div>
<div class="sect3">
<h4 id="_from_a_json_request">10.1.1. From a JSON request</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. JSON credentials extraction configuration properties</caption>
<colgroup>
<col style="width: 80%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.useJsonCredentials</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.usernamePropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.passwordPropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The default implementation expects a request like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. Example JSON authentication request</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">john.doe</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dontTellAnybody</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use <code>usernamePropertyName</code> and <code>passwordPropertyName</code> properties mentioned above, your JSON request can look like:</p>
</div>
<div class="listingblock">
<div class="title">Listing 6. Custom JSON authentication request</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">login</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">john.doe</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">pwd</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dontTellAnybody</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the following config:</p>
</div>
<div class="listingblock">
<div class="title">Listing 7. Custom JSON authentication configuration properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.plugin.springsecurity.rest.login.usernamePropertyName = <span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>
grails.plugin.springsecurity.rest.login.passwordPropertyName = <span class="string"><span class="delimiter">'</span><span class="content">pwd</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If your JSON request format is different, you can plug your own implementation by defining a class which extends
<a href="https://grails-plugins.github.io/grails-spring-security-rest/6.0.0-SNAPSHOT/docs/gapi/grails/plugin/springsecurity/rest/credentials/AbstractJsonPayloadCredentialsExtractor.html">AbstractJsonPayloadCredentialsExtractor</a>.
The default implementation looks like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 8. <code>DefaultJsonPayloadCredentialsExtractor</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">/**
 * Extracts credentials from a JSON request like: &lt;code&gt;{&quot;username&quot;: &quot;foo&quot;, &quot;password&quot;: &quot;bar&quot;}&lt;/code&gt;
 */</span>
<span class="annotation">@Slf4j</span>
<span class="type">class</span> <span class="class">DefaultJsonPayloadCredentialsExtractor</span> <span class="directive">extends</span> AbstractJsonPayloadCredentialsExtractor {

    <span class="predefined-type">String</span> usernamePropertyName
    <span class="predefined-type">String</span> passwordPropertyName

    UsernamePasswordAuthenticationToken extractCredentials(HttpServletRequest httpServletRequest) {
        <span class="keyword">def</span> jsonBody = getJsonBody(httpServletRequest)

        <span class="keyword">if</span> (jsonBody) {
            <span class="predefined-type">String</span> username = jsonBody.<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>usernamePropertyName<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
            <span class="predefined-type">String</span> password = jsonBody.<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>passwordPropertyName<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>

            log.debug <span class="string"><span class="delimiter">&quot;</span><span class="content">Extracted credentials from JSON payload. Username: </span><span class="inline"><span class="inline-delimiter">${</span>username<span class="inline-delimiter">}</span></span><span class="content">, password: </span><span class="inline"><span class="inline-delimiter">${</span>password?.size()?<span class="string"><span class="delimiter">'</span><span class="content">[PROTECTED]</span><span class="delimiter">'</span></span>:<span class="string"><span class="delimiter">'</span><span class="content">[MISSING]</span><span class="delimiter">'</span></span><span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>

            <span class="keyword">new</span> UsernamePasswordAuthenticationToken(username, password)
        } <span class="keyword">else</span> {
            log.debug <span class="string"><span class="delimiter">&quot;</span><span class="content">No JSON body sent in the request</span><span class="delimiter">&quot;</span></span>
            <span class="keyword">return</span> <span class="predefined-constant">null</span>
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you are done, register it in <code>resources.groovy</code> with the name <code>credentialsExtractor</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_from_request_parameters">10.1.2. From request parameters</h4>
<div class="paragraph">
<p>Note that the name of the parameters can also be customised:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Parameter extraction configuration options</caption>
<colgroup>
<col style="width: 80%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.useRequestParamsCredentials</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.usernamePropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.login.passwordPropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_logout">10.2. Logout</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Logout is not possible when using JWT tokens (the default strategy), as no state is kept in the server. If
you still want to have logout, you can provide your own implementation by creating a subclass of
<a href="https://grails-plugins.github.io/grails-spring-security-rest/6.0.0-SNAPSHOT/docs/gapi/grails/plugin/springsecurity/rest/token/storage/jwt/JwtTokenStorageService.html">role=include</a>
and overriding the methods <code>storeToken</code> and <code>removeToken</code>.</p>
</div>
<div class="paragraph">
<p>Then, register your implementation in <code>resources.groovy</code> as <code>tokenStorageService</code>.</p>
</div>
<div class="paragraph">
<p>However, a more rational approach would be just to remove the token from the client (eg, browser&#8217;s local storage) and
let the tokens expire (they will expire anyway, unlike with other storages like Memcached or Redis where they get refreshed
on every access).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="https://grails-plugins.github.io/grails-spring-security-rest/6.0.0-SNAPSHOT/docs/gapi/grails/plugin/springsecurity/rest/RestLogoutFilter.html">logout filter</a>
exposes an endpoint for deleting tokens. It will read the token from an HTTP header. If found, will delete it from the
storage, sending a 200 response. Otherwise, it will send a 404 response.</p>
</div>
<div class="paragraph">
<p>You can configure it using this properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Logout configuration options</caption>
<colgroup>
<col style="width: 80%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.logout.endpointUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/api/logout</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.validation.headerName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X-Auth-Token</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tokenGeneration">11. Token Generation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the plugin generates JWT tokens. Note that when using JWT, you can&#8217;t plug any other token generator. For
more information about how this plugin uses JWT&#8217;s, check the <a href="#tokenStorage">Token Storage</a> section.</p>
</div>
<div class="sect2">
<h3 id="_jwt">11.1. JWT</h3>
<div class="sect3">
<h4 id="_claims">11.1.1. Claims</h4>
<div class="paragraph">
<p>It is possible, to include additional claims in the JWT generated. To do so, you can plug one or more implementations of the interface
<a href="https://grails-plugins.github.io/grails-spring-security-rest/6.0.0-SNAPSHOT/docs/gapi/grails/plugin/springsecurity/rest/token/generation/jwt/CustomClaimProvider.html">CustomClaimProvider</a>,
and register them in Spring.</p>
</div>
<div class="paragraph">
<p>The plugin comes prepackaged with a
<a href="https://grails-plugins.github.io/grails-spring-security-rest/6.0.0-SNAPSHOT/docs/gapi/grails/plugin/springsecurity/rest/token/generation/jwt/IssuerClaimProvider.html">IssuerClaimProvider</a>,
that sets the <code>iss</code> field of the JWT claim set, and which value is configurable using the following configuration property:
<code>grails.plugin.springsecurity.rest.token.generation.jwt.issuer</code>.</p>
</div>
<div class="paragraph">
<p>Customising the JWT to include additional claims is a piece of cake. First, create the claim provider:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookListClaimProvider</span> <span class="directive">implements</span> CustomClaimProvider {

    <span class="annotation">@Override</span>
    <span class="type">void</span> provideCustomClaims(JWTClaimsSet.Builder builder, UserDetails details, <span class="predefined-type">String</span> principal, <span class="predefined-type">Integer</span> expiration) {
        builder.claim(<span class="string"><span class="delimiter">'</span><span class="content">books</span><span class="delimiter">'</span></span>, <span class="predefined-type">Book</span>.findAllByAuthor(details.username).collect { <span class="local-variable">it</span>.name })
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, register it in Spring via <code>resources.groovy</code>, or using the <code>@Bean</code> annotation in a method of the <code>Application</code> class
(or any <code>@Configuration</code> class):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Bean</span>
CustomClaimProvider bookListClaimProvider() {
    <span class="keyword">new</span> BookListClaimProvider()
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_algorithms">11.1.2. Algorithms</h4>
<div class="paragraph">
<p>This plugin uses <a href="http://connect2id.com/products/nimbus-jose-jwt">Nimbus JOSE+JWT</a> library to generate and parse JWT&#8217;s,
and the signing / encryption algorithms are configurable, as long as they are supported in Nimbus.</p>
</div>
<div class="paragraph">
<p>If using signed JWT&#8217;s, the relevant configuration is the following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Signed JWT configuration options</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Possible values</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.generation.jwt.algorithm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any <a href="http://static.javadoc.io/com.nimbusds/nimbus-jose-jwt/4.26.1/com/nimbusds/jose/JWSAlgorithm.html"><code>JWSAlgorithm</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HS256</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.jwt.secret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least 256 bits (32 characters)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When using encrypted JWT&#8217;s, those are the possible configuration options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Encrypted JWT configuration options</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Possible values</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.generation.jwt.jweAlgorithm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any <a href="http://static.javadoc.io/com.nimbusds/nimbus-jose-jwt/4.26.1/com/nimbusds/jose/JWEAlgorithm.html"><code>JWEAlgorithm</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RSA-OAEP</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.generation.jwt.encryptionMethod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any <a href="http://static.javadoc.io/com.nimbusds/nimbus-jose-jwt/4.26.1/com/nimbusds/jose/EncryptionMethod.html"><code>EncryptionMethod</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>A128GCM</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_memcached_gorm_redis_grails_cache">11.2. Memcached, GORM, Redis, Grails Cache</h3>
<div class="paragraph">
<p>If you are not using JWT, but any stateful strategy like Memcached or GORM, the following strategies are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://grails-plugins.github.io/grails-spring-security-rest/6.0.0-SNAPSHOT/docs/gapi/grails/plugin/springsecurity/rest/token/generation/SecureRandomTokenGenerator.html">Using java.security.SecureRandom</a>.</p>
</li>
<li>
<p><a href="https://grails-plugins.github.io/grails-spring-security-rest/6.0.0-SNAPSHOT/docs/gapi/grails/plugin/springsecurity/rest/token/generation/UUIDTokenGenerator.html">Using java.util.UUID</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The strategy used is configurable:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Token generation configuration options</caption>
<colgroup>
<col style="width: 80%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.generation.useSecureRandom</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.generation.useUUID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Both of them generate tokens of 32 alphanumeric characters.</p>
</div>
<div class="paragraph">
<p>That should be enough for most of the human beings. But if you still want to provide your own implementation,
simply write a class implementing
<a href="https://grails-plugins.github.io/grails-spring-security-rest/6.0.0-SNAPSHOT/docs/gapi/grails/plugin/springsecurity/rest/token/generation/TokenGenerator.html">role=include</a>
and wire it up in <code>resources.groovy</code> as <code>tokenGenerator</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tokenStorage">12. Token Storage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The tokens are stored on the server using a <code>tokenStorageService</code> bean. The plugin comes with out-of-the-box support
for JWT, Memcached, GORM and <a href="http://grails.org/plugin/cache">Grails Cache</a>, but you can use your own strategy implementing the
<a href="https://grails-plugins.github.io/grails-spring-security-rest/6.0.0-SNAPSHOT/docs/gapi/grails/plugin/springsecurity/rest/token/storage/TokenStorageService.html">role=include</a>
interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The default implementation, JWT, is stateless. Nothing is really stored. However, the plugin still gives a
chance to the other implementations to store the principal if they need to.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_json_web_token">12.1. JSON Web Token</h3>
<div class="paragraph">
<p>JSON Web Token (JWT) is an <a href="https://tools.ietf.org/html/rfc7519">IETF standard</a> which defines a secure way to encapsulate arbitrary data that can be sent over unsecure URL&#8217;s.</p>
</div>
<div class="paragraph">
<p>Generally speaking, JWT&#8217;s can be useful in the following use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When generating "one click" action emails, like "delete this comment" or "add this to favorites". Instead of giving
the users URL&#8217;s like <code>/comment/delete/123</code>, you can give them something like <code>/comment/delete/&lt;JWT_TOKEN&gt;</code>, where the
<code>JWT_TOKEN</code> contains encapsulated information about the user and the comment, in a safe way, so authentication is not required.</p>
</li>
<li>
<p>To achieve single sign-on, by sharing a JWT across applications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the context of authentication and authorization, JWT will help you implement a stateless implementation, as the
principal information is stored directly in the JWT.</p>
</div>
<div class="sect3">
<h4 id="_how_does_a_jwt_looks_like">12.1.1. How does a JWT looks like?</h4>
<div class="imageblock">
<div class="content">
<img src="images/jwt.png" alt="jwt">
</div>
<div class="title">Figure 2. JWT example</div>
</div>
<div class="sect4">
<h5 id="_header">Header</h5>
<div class="paragraph">
<p>A base64-encoded JSON like:</p>
</div>
<div class="listingblock">
<div class="title">Listing 9. JWT header</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">alg</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">HS256</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">typ</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">JWT</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_claims_2">Claims</h5>
<div class="paragraph">
<p>A base64-encoded JSON like:</p>
</div>
<div class="listingblock">
<div class="title">Listing 10. JWT claims</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">exp</span><span class="delimiter">&quot;</span></span>: <span class="integer">1422990129</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">sub</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">jimi</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">roles</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_ADMIN</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_USER</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">iat</span><span class="delimiter">&quot;</span></span>: <span class="integer">1422986529</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_signature">Signature</h5>
<div class="paragraph">
<p>Depends on the algorithm specified on the header, it can be a digital signature of the base64-encoded header and claims,
or an encryption of them using RSA.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_signed_jwts">12.1.2. Signed JWT&#8217;s</h4>
<div class="paragraph">
<p>By default, this plugin uses signed JWT&#8217;s as specified by the
<a href="https://tools.ietf.org/html/draft-ietf-jose-json-web-signature">JSON Web Signature</a> specification. More specifically,
the algorithm used is HMAC SHA-256 with a specified shared secret. The relevant configuration properties are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. JWT configuration options for signing</caption>
<colgroup>
<col style="width: 80%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.jwt.useSignedJwt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.jwt.secret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code> //Needs to be set or the app won&#8217;t boot</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.jwt.expiration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3600</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.jwt.refreshExpiration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(No Expiration)</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_encrypted_jwts">12.1.3. Encrypted JWT&#8217;s</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Grails&#8217;s <code>grails-docs</code> artifact includes a version of <code>com.lowagie:itext</code> which in turns bring old BouncyCastle&#8217;s libraries
into the classpath. To avoid the problem, you have to override explicitly that dependency:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. Excluding BouncyCastle&#8217;s libraries</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">build(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.lowagie:itext:2.0.8</span><span class="delimiter">&quot;</span></span>) { excludes <span class="string"><span class="delimiter">&quot;</span><span class="content">bouncycastle:bcprov-jdk14:138</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.bouncycastle:bcprov-jdk14:1.38</span><span class="delimiter">&quot;</span></span> }
{code}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the previous strategy, the claims are just signed, so it prevents an attacker to tamper its contents to introduce
malicious data or try a privilege escalation by adding more roles. However, the claims can be decoded just by using
Base 64.</p>
</div>
<div class="paragraph">
<p>If the claims contains sensitive information, you can use a
<a href="https://tools.ietf.org/html/draft-ietf-jose-json-web-encryption">JSON Web Encryption</a> algorithm to prevent them to be decoded.
Particularly, this plugin uses RSAES OAEP for key encryption and AES GCM (Galois/Counter Mode) algorithm with a 256 bit key
for content encryption.</p>
</div>
<div class="paragraph">
<p>By default, RSA public/private keys are generated every time the application runs. This means that  generated tokens
won&#8217;t be decrypted across executions of the application. So better create your own key pair using OpenSSL:</p>
</div>
<div class="listingblock">
<div class="title">Listing 12. Certificate generation for JWT</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">openssl genrsa -out private_key.pem 2048
openssl pkcs8 -topk8 -inform PEM -outform DER -in private_key.pem -out private_key.der -nocrypt
openssl rsa -in private_key.pem -pubout -outform DER -out public_key.der</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, configure the keys properly, along with the rest of the configuration:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. JWT configuration options for signing</caption>
<colgroup>
<col style="width: 80%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.jwt.useEncryptedJwt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.jwt.privateKeyPath</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.jwt.publicKeyPath</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example configuration:</p>
</div>
<div class="listingblock">
<div class="title">Listing 13. JWT encryption example configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.plugin.springsecurity.rest.token.storage.jwt.useEncryptedJwt = <span class="predefined-constant">true</span>
grails.plugin.springsecurity.rest.token.storage.jwt.privateKeyPath = <span class="string"><span class="delimiter">'</span><span class="content">/path/to/private_key.der</span><span class="delimiter">'</span></span>
grails.plugin.springsecurity.rest.token.storage.jwt.publicKeyPath = <span class="string"><span class="delimiter">'</span><span class="content">/path/to/public_key.der</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The performance of encryption algorithms is much slower compared with signing ones. If you are considering encrypting
you JWT&#8217;s, think if you really need it.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_token_expiration_and_refresh_tokens">12.1.4. Token expiration and refresh tokens</h4>
<div class="paragraph">
<p>When using JWT, issued access tokens expire after a period of time, and they are paired with refresh tokens, eg:</p>
</div>
<div class="listingblock">
<div class="title">Listing 14. Sample access token response, including refresh token</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
   <span class="key"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">jimi</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">roles</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_ADMIN</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_USER</span><span class="delimiter">&quot;</span></span>
   ],
   <span class="key"><span class="delimiter">&quot;</span><span class="content">expires_in</span><span class="delimiter">&quot;</span></span>: <span class="integer">3600</span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">token_type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Bearer</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">refresh_token</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.fUaSWIdZakFX7CyimRIPhuw0sfevgmwL2xzm5H0TuaqwKx24EafCO0TruGKG-lN-wGCITssnF2LQTqRzQGp0PoLXHfUJ0kkz5rBl6LtnRu7cdD1ZUNYXLJtFjQ3IATzoo15tPafRPyStG1Qm7-1L0VxquhrLxkkpti0F1_VTytZAq8ltFrnxM4ahJUwS7eriivvdLqmHtnwuXw0kBXEseIyCkiyKklWDJAcD_P_gHoQJvSCoXedlr7Pp0n6LEUrRWJ2Hb-Zyt9dWqWDxm9nyDeEVtEZGcQtpgCGgbXxaUpULIy5nvrbRzXSNyT6iXhK1CLqiFVkfh-Y-DHXdB6Q4sg.uYdpxl835KnlkqC5.gBgSnPWZOo6FINovJNG7Xx2RuS09QJbU4-_J4EgZQkygt8xE-HfdYaOmtmJLjGJR1XKoaRsuX1gNjFoCZgqWAon6.Zsrk52dkjskSVQLXZBQooQ</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">access_token</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.n-gGe65x0SlSXS3fTG8ZLdXvv6b5_1pDvkcGyCjFy-vm1VhaBEQL5p3hc6iUcCAcuyrqzGk95lV9dHCv46cNfCiUFHWfbEcd4nqScIxBbc28xO9L1mNLnZ0G1rx1Mx1L0Y_ZPoSxDXpJaHCT28cdZffHLxx2B9ioIClgdlYBAJ5Oz8VT39-D0QSomS6QhFqmcpbDsXrsKxs545Pn-TIlu-fSQ4wpIvAxusOKB6CV2EYKqBplMBrh-3btE8WksVcX2N3LsrcMhrKxSKi93c06MZh6JzSLWe5bl9hvUvBdEuwDrk-fQgD3ZlmjjoevRWYhv_kslW1PlqUHYmKOQ7csUw.3mvvsFWikEjZzExA.YixjnnzzcPRy_uUpgPv5zqOfshv3pUwfrME0AijpsB7u9CmJe94g6f2y_3vqUps-5weKKGZyk3ZtnwEbPVAk9-HZt-Y27SbZl4JNCFEOLVsMsK8.h4j9BdFXuWKKez6xxRAwJA</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Refresh tokens never expire, by default, and can be used to obtain a new access token by sending a POST request to the
<code>/oauth/access_token</code> endpoint.</p>
</div>
<div class="paragraph">
<p>If you prefer to configure your refresh tokens to expire automatically, you can set
<code>grails.plugin.springsecurity.rest.token.storage.jwt.refreshExpiration</code> to the number of seconds before the token
is invalid. After this period, a client would be forced to present login credentials in order to obtain a new access token.</p>
</div>
<div class="listingblock">
<div class="title">Listing 15. Sample HTTP request to obtain an access token</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">POST /myApp/oauth/access_token HTTP/<span class="float">1.1</span>
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

grant_type=refresh_token&amp;refresh_token=eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ....</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, is a form request with 2 parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>grant_type</code>: must be <code>refresh_token</code> always.</p>
</li>
<li>
<p><code>refresh_token</code>: the refresh token provided earlier.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, refresh tokens never expire and must be securely stored in your client application. See
<a href="https://tools.ietf.org/html/rfc6749#section-10.4">section 10.4 of the OAuth 2.0 spec</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_memcached">12.2. Memcached</h3>
<div class="paragraph">
<p>To use Memcached, simply define the following configuration properties to match your environments accordingly:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Memcached configuration options</caption>
<colgroup>
<col style="width: 80%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.memcached.hosts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localhost:11211</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.memcached.username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>''</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.memcached.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>''</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.memcached.expiration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3600</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For development, if you have Memcached installed locally with the default settings, it should  just work with the defaults.</p>
</div>
<div class="paragraph">
<p>In Memcached tokens will expire automatically after the configured timeout (1h by default).
They get refreshed on every access</p>
</div>
</div>
<div class="sect2">
<h3 id="_gorm">12.3. GORM</h3>
<div class="paragraph">
<p>To use GORM, these are the relevant configuration properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. GORM configuration options</caption>
<colgroup>
<col style="width: 80%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.gorm.tokenDomainClassName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.gorm.tokenValuePropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tokenValue</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.gorm.usernamePropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The relevant domain class should look something like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 16. Authentication token domain class example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.example.product

<span class="type">class</span> <span class="class">AuthenticationToken</span> {

    <span class="predefined-type">String</span> tokenValue
    <span class="predefined-type">String</span> username

    <span class="directive">static</span> mapping = {
        version <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For the <code>tokenDomainClassName</code> configuration you must enter a fully qualified class name. In the case of the example above:
<code>grails.plugin.springsecurity.rest.token.storage.gorm.tokenDomainClassName = 'org.example.product.AuthenticationToken'</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A few things to take into consideration when using GORM for token storage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Instead of storing the whole <code>UserDetails</code> object, probably only the username is needed. This is because applications
using this strategy will probably have the standard User and Role domain classes. When the token is verified the username
is passed to the default <code>userDetailsService</code> bean, which in the case of the default Spring Security Core GORM
implementation will fetch the information from the mentioned domain classes.</p>
</li>
<li>
<p>GORM&#8217;s optimistic locking feature is likely unnecessary and may cause performance issues.</p>
</li>
<li>
<p>You&#8217;ll have to handle token expiration by yourself via Quartz jobs or a similar mechanism. There are various ways you might
go about this.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_gorm_token_expiration_examples">12.3.1. GORM Token Expiration Examples</h4>
<div class="paragraph">
<p>Adding a GORM autoTimestamp property like <code>lastUpdated</code> or <code>dateCreated</code> and sorting out stale or old tokens with Quartz jobs
are the most obvious routes. Each has its drawbacks though.</p>
</div>
<div class="paragraph">
<p><code>dateCreated</code> is useful if you want tokens to expire a set time after they are issued. However, API users who didn&#8217;t pay
attention to when their token was issued may find themselves needing a new token unexpectedly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Date</span> dateCreated</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>lastUpdated</code> requires a change to the token domain instance in order to be triggered. Something as simple as an access
counter may work as a strategy to keepTokens fresh, but doing a write to a disk based database on each token access may
be something you would prefer to avoid for the sake of performance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Date</span> lastUpdated
<span class="predefined-type">Integer</span> accessCount = <span class="integer">0</span>

<span class="keyword">def</span> <span class="function">afterLoad</span>() {
  accessCount++
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Simply using your own date or timestamp is also a valid option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Date</span> refreshed = <span class="keyword">new</span> <span class="predefined-type">Date</span>()

<span class="keyword">def</span> <span class="function">afterLoad</span>() {
    <span class="comment">// if being accessed and it is more than a day since last marked as refreshed</span>
    <span class="comment">// and it hasn't been wiped out by Quartz job (it exists, duh)</span>
    <span class="comment">// then refresh it</span>
    <span class="keyword">if</span> (refreshed &lt; <span class="keyword">new</span> <span class="predefined-type">Date</span>() -<span class="integer">1</span>) {
        refreshed = <span class="keyword">new</span> <span class="predefined-type">Date</span>()
        <span class="local-variable">it</span>.save()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example quartz job to go with the custom refresh timestamp above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">RemoveStaleTokensJob</span> {
    <span class="directive">static</span> triggers = {
        cron <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">every4hours</span><span class="delimiter">'</span></span>, <span class="key">cronExpression</span>: <span class="string"><span class="delimiter">'</span><span class="content">0 0 */4 * * *</span><span class="delimiter">'</span></span>
    }

    <span class="type">void</span> execute() {
        AuthenticationToken.executeUpdate(<span class="string"><span class="delimiter">'</span><span class="content">delete AuthenticationToken a where a.refreshed &lt; ?</span><span class="delimiter">'</span></span> [<span class="keyword">new</span> <span class="predefined-type">Date</span>()-<span class="integer">1</span>])
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_redis">12.4. Redis</h3>
<div class="paragraph">
<p>To use Redis as a token store simply you just have to enable it in you configuration by setting <code>useRedis</code> to <code>true</code>
(see table below).</p>
</div>
<div class="paragraph">
<p>You have to have the <code>redis</code> plugin installed in order to be able to use Redis as your token store. Refer to the
<a href="https://github.com/grails-plugins/grails-redis">Redis plugin documentation</a> for more details about how to configure it.</p>
</div>
<div class="paragraph">
<p>Configuration options for Redis:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Redis configuration options</caption>
<colgroup>
<col style="width: 80%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.redis.expiration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3600</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_grails_cache">12.5. Grails Cache</h3>
<div class="paragraph">
<p>To use <a href="http://grails.org/plugin/cache">Grails Cache</a>, simply define a cache name:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Redis configuration options</caption>
<colgroup>
<col style="width: 80%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.storage.grailsCacheName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defaultTokenCache</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The cache name should correspond to a name specified in the [cache DSL|http://grails-plugins.github.io/grails-cache/docs/manual/guide/usage.html#dsl].</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Token expiration / eviction / TTL</div>
<div class="paragraph">
<p>By default, Spring Cache abstraction
<a href="http://docs.spring.io/spring/docs/4.0.x/spring-framework-reference/html/cache.html#cache-specific-config">does not support expiration</a>.
It depends on the specific support of the actual providers. Grails has several plugins for this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://grails-plugins.github.io/grails-cache/guide/usage.html#dsl">Core</a>: unsupported.</p>
</li>
<li>
<p><a href="http://grails-plugins.github.io/grails-cache-ehcache/guide/usage.html#dsl">Ehcache</a>: supported.</p>
</li>
<li>
<p><a href="http://grails-plugins.github.io/grails-cache-redis/guide/usage.html#dsl">Redis</a>: unsupported.</p>
</li>
<li>
<p><a href="http://grails.org/plugin/cache-gemfire">Gemfire</a>: unsupported.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is a bug in <code>:cache-ehcache:1.0.0</code> plugin that will cause issues. It&#8217;s recommended that you use the latest version.
See <a href="https://github.com/grails/grails-spring-security-rest/issues/89">#89</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tokenRendering">13. Token Rendering</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, this plugin renders the token in <a href="http://tools.ietf.org/html/rfc6750">RFC 6750 Bearer Token</a> format:</p>
</div>
<div class="listingblock">
<div class="title">Sample Access token response</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">HTTP/<span class="float">1.1</span> <span class="integer">200</span> OK
Content-Type: application/json;charset=UTF-<span class="integer">8</span>
Cache-Control: no-store
Pragma: no-cache

{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">access_token</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eyJhbGciOiJIUzI1NiJ9...</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">token_type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Bearer</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">john.doe</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">roles</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_ADMIN</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_USER</span><span class="delimiter">&quot;</span></span>
    ]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As per the RFC, <code>access_token</code> and <code>token_type</code> property names cannot be customised.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The JSON structure can be customised with the following configuration keys:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Token rendering configuration options</caption>
<colgroup>
<col style="width: 80%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.rendering.usernamePropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.rendering.authoritiesPropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>roles</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>E.g., with the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.plugin.springsecurity.rest.token.rendering.usernamePropertyName = <span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>
grails.plugin.springsecurity.rest.token.rendering.authoritiesPropertyName = <span class="string"><span class="delimiter">'</span><span class="content">permissions</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">access_token</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eyJhbGciOiJIUzI1NiJ9...</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">token_type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Bearer</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">login</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">john.doe</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">permissions</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_ADMIN</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_USER</span><span class="delimiter">&quot;</span></span>
    ]
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_disabling_bearer_tokens_support_for_full_response_customisation">13.1. Disabling bearer tokens support for full response customisation</h3>
<div class="paragraph">
<p>In order to fully customise the response, you need first to disable bearer tokens support by setting
<code>grails.plugin.springsecurity.rest.token.validation.useBearerToken = false</code>. That will enable you to use this additional
property:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Token rendering configuration options</caption>
<colgroup>
<col style="width: 80%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.rendering.tokenPropertyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>access_token</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Disabling bearer token support impacts the way tokens are extracted from the HTTP request. Please, read carefully
the chapter about token validation first.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want your own implementation, simply create a class implementing
<a href="https://grails-plugins.github.io/grails-spring-security-rest/6.0.0-SNAPSHOT/docs/gapi/grails/plugin/springsecurity/rest/token/rendering/AccessTokenJsonRenderer.html">role=include</a>
and wire it up in <code>resources.groovy</code> with name <code>accessTokenJsonRenderer</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The principal object stored in the security context, and passed to the JSON renderer, is coming from the configured
authentication providers. In most cases, this will be a <code>UserDetails</code> object retrieved using the <code>userDetailsService</code> bean.</p>
</div>
<div class="paragraph">
<p>If you want to render additional information in your JSON response, you have to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure an alternative <code>userDetailsService</code> bean that retrieves the additional information you want, and put it in a principal object.</p>
</li>
<li>
<p>Configure an alternative <code>accessTokenJsonRenderer</code> that reads that information from the <code>restAuthenticationToken.principal</code> object.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tokenValidation">14. Token Validation Filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The token validation filter looks for the token in the request and then tries to validate it using the configured
token storage implementation.</p>
</div>
<div class="paragraph">
<p>If the validation is successful, the principal object is stored in the security context. This allows you to use in
your application <code>@Secured</code>, <code>springSecurityService.principal</code> and so on.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>springSecurityService.currentUser</code> expects a <code>grails.plugin.springsecurity.userdetails.GrailsUser</code> to perform a DB query.
However, this plugins stores in the security context just a principal <code>Object</code>, because it does not assume you are using
domain classes to store the users. Use <code>springSecurityService.principal</code> instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This plugin supports <a href="http://tools.ietf.org/html/rfc6750">RFC 6750 Bearer Token</a> specification out-of-the-box.</p>
</div>
<div class="sect2">
<h3 id="_sending_tokens_in_the_request">14.1. Sending tokens in the request</h3>
<div class="paragraph">
<p>The token can be sent in the <code>Authorization</code> request header:</p>
</div>
<div class="listingblock">
<div class="title">Listing 17. Accessing a protected resource using <code>Authorization</code> request header</div>
<div class="content">
<pre class="CodeRay highlight"><code>GET /protectedResource HTTP/1.1
Host: server.example.com
Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0MjI5OTU5MjIsInN1YiI6ImppbWkiLCJyb2xlcyI6WyJST0xFX0FETUlOIiwiUk9MRV9VU0VSIl0sImlhdCI6MTQyMjk5MjMyMn0.rA7A2Gwt14LaYMpxNRtrCdO24RGrfHtZXY9fIjV8x8o</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or using form-encoded body parameters:</p>
</div>
<div class="listingblock">
<div class="title">Listing 18. Accessing a protected resource using body parameters</div>
<div class="content">
<pre class="CodeRay highlight"><code>POST /protectedResource HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

access_token=eyJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0MjI5OTU5MjIsInN1YiI6ImppbWkiLCJyb2xlcyI6WyJST0xFX0FETUlOIiwiUk9MRV9VU0VSIl0sImlhdCI6MTQyMjk5MjMyMn0.rA7A2Gwt14LaYMpxNRtrCdO24RGrfHtZXY9fIjV8x8o</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need to use the <code>GET</code> HTTP method (to render images in an <code>img</code> tag, for example), you can also send the access token
in a query string parameter named <code>access_token</code>:</p>
</div>
<div class="paragraph">
<p>If you disable the bearer token support, you can customise it further:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.plugin.springsecurity.rest.token.validation.useBearerToken = <span class="predefined-constant">false</span>
grails.plugin.springsecurity.rest.token.validation.headerName = <span class="string"><span class="delimiter">'</span><span class="content">X-Auth-Token</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you still want to have full access and read the token from a different part of the request, you can implement a
<a href="https://grails-plugins.github.io/grails-spring-security-rest/6.0.0-SNAPSHOT/docs/gapi/grails/plugin/springsecurity/rest/token/reader/TokenReader.html">role=include</a>
and register it in your <code>resources.groovy</code>  as <code>tokenReader</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must disable bearer token support to register your own <code>tokenReader</code> implementation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_anonymous_access">14.2. Anonymous access</h3>
<div class="paragraph">
<p>If you want to enable anonymous access to URL&#8217;s where this plugin&#8217;s filters are applied, you need to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure <code>enableAnonymousAccess = true</code> (see table below).</p>
</li>
<li>
<p>Make sure that the <code>anonymousAuthenticationFilter</code> is applied before <code>restTokenValidationFilter</code>. See how to configure filters for more details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, with this configuration:</p>
</div>
<div class="listingblock">
<div class="title">Sample configuration to allow anonymous access</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails {
    plugin {
        springsecurity {
            filterChain {
                chainMap = [
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/api/guest/**</span><span class="delimiter">'</span></span>, <span class="key">filters</span>: <span class="string"><span class="delimiter">'</span><span class="content">anonymousAuthenticationFilter,restTokenValidationFilter,restExceptionTranslationFilter,filterInvocationInterceptor</span><span class="delimiter">'</span></span>],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/api/**</span><span class="delimiter">'</span></span>,       <span class="key">filters</span>: <span class="string"><span class="delimiter">'</span><span class="content">JOINED_FILTERS,-anonymousAuthenticationFilter,-exceptionTranslationFilter,-authenticationProcessingFilter,-securityContextPersistenceFilter,-rememberMeAuthenticationFilter</span><span class="delimiter">'</span></span>],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/**</span><span class="delimiter">'</span></span>,           <span class="key">filters</span>: <span class="string"><span class="delimiter">'</span><span class="content">JOINED_FILTERS,-restTokenValidationFilter,-restExceptionTranslationFilter</span><span class="delimiter">'</span></span>]
                ]
            }

            <span class="comment">//Other Spring Security settings</span>
            <span class="comment">//...</span>

            rest {
                token {
                    validation {
                        enableAnonymousAccess = <span class="predefined-constant">true</span>
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following chains are configured:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>/api/guest/**</code> is a stateless chain that allows anonymous access when no token is sent. If however a token is on the request, it will be validated.</p>
</li>
<li>
<p><code>/api/**</code> is a stateless chain that doesn&#8217;t allow anonymous access. Thus, the token will always be required, and if missing, a Bad Request reponse will be sent back to the client.</p>
</li>
<li>
<p><code>/**</code> (read: everything else) is a traditional stateful chain.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_validation_endpoint">14.3. Validation Endpoint</h3>
<div class="paragraph">
<p>There is also an endpoint available that you can call in case you want to know if a given token is valid. It looks for
the token in a HTTP header as well, and if the token is still valid, it renders guide:authentication[its JSON representation].
If the token does not exist, it will render a <code>grails.plugin.springsecurity.rest.login.failureStatusCode</code> response
(<code>401</code> by default).</p>
</div>
<div class="paragraph">
<p>The relevant configuration properties for the validation endpoint are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Validation endpoint configuration options</caption>
<colgroup>
<col style="width: 80%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Config key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.validation.active</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.validation.headerName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X-Auth-Token</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.rest.token.validation.endpointUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/api/validate</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that <code>headerName</code> is only considered if <code>grails.plugin.springsecurity.rest.token.validation.useBearerToken</code> is set
to <code>false</code>. Otherwise (the default approach), as per RFC 6750, the header name will be <code>Authorization</code> and the value
will be <code>Bearer TOKEN_VALUE</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cors">15. CORS support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since Grails 3.2.1, CORS support is built-in into the framework. Check the
<a href="http://docs.grails.org/latest/guide/theWebLayer.html#cors">documentation on the Grails guide</a> for more information.</p>
</div>
<div class="paragraph">
<p>If you are using any Grails 3 version prior to 3.2.1, you can define your own filter, as described in
<a href="https://github.com/davidtinker/grails-cors#grails-3" class="bare">https://github.com/davidtinker/grails-cors#grails-3</a>.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can also use <a href="https://github.com/appcela/grails3-cors-interceptor">this plugin</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="oauth">16. Delegating authentication to OAuth providers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This plugin is meant to be used in applications serving a REST API&#8217;s to pure Javascript clients. The main authentication
flow of this plugin is to allow you to authenticate your users against any Spring Security-compatible user directory
(like a DB or an LDAP server).</p>
</div>
<div class="paragraph">
<p>However, there might be situations where you want to delegate the authentication against a third-party provider, like
Google or Facebook. Unfortunately, your pure Javascript front-end application cannot request the providers directly using
OAuth, because then the access keys will be made public.</p>
</div>
<div class="paragraph">
<p>So is this plugin&#8217;s responsibility to provide endpoints so your Grails backend acts as a proxy for your front-end client.</p>
</div>
<div class="paragraph">
<p>The flow is something like the following:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/oauth.png" alt="oauth">
</div>
<div class="title">Figure 3. OAuth delegation protocol</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client application requests and endpoint that requires authentication, so the server responds with a 401 response (*).</p>
</li>
<li>
<p>The client redirects the user to the login form (*).</p>
</li>
<li>
<p>This time, instead of using username and password, the user clicks on "Login with Google" button.</p>
</li>
<li>
<p>Browser navigates to a Grails URL. Grails will generate a Google Login URL, giving Google a Grails callback URL.</p>
</li>
<li>
<p>Browser navigates to Google Login. User logs in, and Google redirects the browser to the Grails callback URL.</p>
</li>
<li>
<p>Browser navigates to that Grails callback URL. Then, Grails will use OAuth to fetch user information (like email) from
Google. Based on that, will generate a REST API token and fetch and store principal information. The response from
Grails will be a front-end URL where the token is a parameter.</p>
</li>
<li>
<p>The browser will navigate to that URL, and the Javascript logic will read the token from the URL and store it locally.</p>
</li>
<li>
<p>The client sends again a request to the protected resource, passing the token as an HTTP header (*).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The steps flagged with (*) remain unchanged from the normal flow.</p>
</div>
<div class="paragraph">
<p>The Grails callback URL mentioned above has this general format: <code>${grails.serverURL}/oauth/callback/${providerName}</code>.
You will need to configure such URL in your OAuth 2.0 provider.</p>
</div>
<div class="paragraph">
<p>To support OAuth, this plugin uses <a href="https://github.com/leleuj/pac4j">Profile &amp; Authentication Client for Java</a>. So you
can use any OAuth 2.0 provider they support. This includes at the time of writing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dropbox.</p>
</li>
<li>
<p>Facebook.</p>
</li>
<li>
<p>GitHub.</p>
</li>
<li>
<p>Google.</p>
</li>
<li>
<p>LinkedIn.</p>
</li>
<li>
<p>Windows Live.</p>
</li>
<li>
<p>Wordpress.</p>
</li>
<li>
<p>Yahoo.</p>
</li>
<li>
<p>Paypal.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that OAuth 1.0a providers also work, like Twitter.</p>
</div>
<div class="paragraph">
<p>If your provider is not supported by pac4j, you can write your own. Please refer to the
<a href="https://github.com/pac4j/pac4j/wiki/Clients#creating-your-own-client">pac4j documentation</a> for that.</p>
</div>
<div class="paragraph">
<p>The plugin also supports <a href="https://www.apereo.org/projects/cas">CAS (Central Authentication Service)</a> using the OAuth
authentication flow. See CAS Authentication for details.</p>
</div>
<div class="paragraph">
<p>To start the OAuth authentication flow, from your frontend application, generate a link to
<code>&lt;YOUR_GRAILS_APP&gt;/oauth/authenticate/&lt;provider&gt;</code>. The user clicking on that link represents step 4 in the previous
diagram.</p>
</div>
<div class="paragraph">
<p>Note that you can define the frontend callback URL in <code>application.groovy</code> under
<code>grails.plugin.springsecurity.rest.oauth.frontendCallbackUrl</code>. You need to define a closure that will be called with
the token value as parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.plugin.springsecurity.rest.oauth.frontendCallbackUrl = { <span class="predefined-type">String</span> tokenValue -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">http://my.frontend-app.com/welcome.token=</span><span class="inline"><span class="inline-delimiter">${</span>tokenValue<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define the URL as a <code>callback</code> parameter in the original link, eg:</p>
</div>
<div class="paragraph">
<p><code>http://your-grails-api.com/oauth/authenticate/google?callback=http://your-frontend-app.com/auth-success.html?token=</code></p>
</div>
<div class="paragraph">
<p>In this case, the token will be <strong>concatenated</strong> to the end of the URL.</p>
</div>
<div class="paragraph">
<p>Upon successful OAuth authorisation (after step 6.1 in the above diagram), an
<a href="https://grails-plugins.github.io/grails-spring-security-rest/6.0.0-SNAPSHOT/docs/gapi/grails/plugin/springsecurity/rest/oauth/OauthUser.html">role=include</a>
will be stored in the security context. This is done by a bean named <code>oauthUserDetailsService</code>. The
<a href="https://grails-plugins.github.io/grails-spring-security-rest/6.0.0-SNAPSHOT/docs/gapi/grails/plugin/springsecurity/rest/oauth/DefaultOauthUserDetailsService.html">role=include</a>
delegates to the configured <code>userDetailsService</code> bean, passing the profile ID as the username:</p>
</div>
<div class="listingblock">
<div class="title">Listing 19. DefaultOauthUserDetailsService</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">/**
 * Builds an {@link OauthUser}. Delegates to the default {@link UserDetailsService#loadUserByUsername(java.lang.String)}
 * where the username passed is {@link UserProfile#getId()}.
 *
 * If the user is not found, it will create a new one with the the default roles.
 */</span>
<span class="annotation">@Slf4j</span>
<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">DefaultOauthUserDetailsService</span> <span class="directive">implements</span> OauthUserDetailsService {

    <span class="annotation">@Delegate</span>
    UserDetailsService userDetailsService

    UserDetailsChecker preAuthenticationChecks

    OauthUser loadUserByUserProfile(UserProfile userProfile, <span class="predefined-type">Collection</span>&lt;GrantedAuthority&gt; defaultRoles)
            <span class="directive">throws</span> UsernameNotFoundException {

        <span class="predefined-type">String</span> userDomainClass = userDomainClassName()
        <span class="keyword">if</span> ( !userDomainClass ) {
            <span class="keyword">return</span> instantiateOauthUser(userProfile, defaultRoles)
        }
        loadUserByUserProfileWhenUserDomainClassIsSet(userProfile, defaultRoles)
    }

    OauthUser loadUserByUserProfileWhenUserDomainClassIsSet(UserProfile userProfile, <span class="predefined-type">Collection</span>&lt;GrantedAuthority&gt; defaultRoles) {
        OauthUser oauthUser
        <span class="keyword">try</span> {
            log.debug <span class="string"><span class="delimiter">&quot;</span><span class="content">Trying to fetch user details for user profile: </span><span class="inline"><span class="inline-delimiter">${</span>userProfile<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
            UserDetails userDetails = userDetailsService.loadUserByUsername userProfile.id

            log.debug <span class="string"><span class="delimiter">&quot;</span><span class="content">Checking user details with </span><span class="inline"><span class="inline-delimiter">${</span>preAuthenticationChecks.class.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
            preAuthenticationChecks?.check(userDetails)

            <span class="predefined-type">Collection</span>&lt;GrantedAuthority&gt; allRoles = <span class="type">[]</span>
            allRoles.addAll(userDetails.authorities)
            allRoles.addAll(defaultRoles)
            oauthUser = <span class="keyword">new</span> OauthUser(userDetails.username, userDetails.password, allRoles, userProfile)
        } <span class="keyword">catch</span> (UsernameNotFoundException ignored) {
            log.debug <span class="string"><span class="delimiter">&quot;</span><span class="content">User not found. Creating a new one with default roles: </span><span class="inline"><span class="inline-delimiter">${</span>defaultRoles<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
            oauthUser = instantiateOauthUser(userProfile, defaultRoles)
        }
        oauthUser
    }

    OauthUser instantiateOauthUser(UserProfile userProfile, <span class="predefined-type">Collection</span>&lt;GrantedAuthority&gt; defaultRoles) {
        <span class="keyword">new</span> OauthUser(userProfile.id, <span class="string"><span class="delimiter">'</span><span class="content">N/A</span><span class="delimiter">'</span></span>, defaultRoles, userProfile)
    }

    <span class="annotation">@CompileDynamic</span>
    <span class="predefined-type">String</span> userDomainClassName() {
        SpringSecurityUtils.getSecurityConfig()?.get(<span class="string"><span class="delimiter">'</span><span class="content">userLookup</span><span class="delimiter">'</span></span>)?.get(<span class="string"><span class="delimiter">'</span><span class="content">userDomainClassName</span><span class="delimiter">'</span></span>)
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to provide your own implementation, define it in <code>resources.groovy</code> with bean name <code>oauthUserDetailsService</code>.
Make sure you implements the interface <code>OauthUserDetailsService</code></p>
</div>
<div class="paragraph">
<p>If you want to do any additional post-OAuth authorisation check, you should do it on your <code>loadUserByUserProfile</code>
implementation. This is useful if you want to allow your corporate users to log into your application using their Gmail
account. In this case, you should decide based on OAuth20Profile.getEmail(), for instance:</p>
</div>
<div class="listingblock">
<div class="title">Listing 20. Custom loadUserByUserProfile implementation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">OauthUser loadUserByUserProfile(OAuth20Profile userProfile, <span class="predefined-type">Collection</span>&lt;GrantedAuthority&gt; defaultRoles) <span class="directive">throws</span> UsernameNotFoundException {
    <span class="keyword">if</span> (userProfile.email.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">example.org</span><span class="delimiter">'</span></span>)) {
        <span class="keyword">return</span> <span class="keyword">new</span> OauthUser(userProfile.id, <span class="string"><span class="delimiter">'</span><span class="content">N/A</span><span class="delimiter">'</span></span>, defaultRoles, userProfile)
    } <span class="keyword">else</span> {
        <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string"><span class="delimiter">&quot;</span><span class="content">User with email </span><span class="inline"><span class="inline-delimiter">${</span>userProfile.email<span class="inline-delimiter">}</span></span><span class="content"> now allowed. Only `example.org accounts are allowed.</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case of any OAuth authentication failure, the plugin will redirect back to the frontend application anyway, so it
has a chance to render a proper error message and/or offer the user the option to try again. In that case, the token
parameter will be empty, and both <code>error</code> and <code>message</code> params will be appended:</p>
</div>
<div class="paragraph">
<p><code>http://your-frontend-app.com/auth-success.html?token=&amp;error=403&amp;message=User+with+email+jimmy%40gmail.com+now+allowed.+Only+%40example.com+accounts+are+allowed</code></p>
</div>
<div class="paragraph">
<p>Below are some examples on how to configure it for Google, Facebook and Twitter.</p>
</div>
<div class="sect2">
<h3 id="_google">16.1. Google</h3>
<div class="paragraph">
<p>Define the following block in your <code>application.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 21. Google OAuth sample configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails {
    plugin {
        springsecurity {

            rest {

                oauth {

                    frontendCallbackUrl = { <span class="predefined-type">String</span> tokenValue -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">http://my.frontend-app.com/welcome#token=</span><span class="inline"><span class="inline-delimiter">${</span>tokenValue<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> }

                    google {

                        client = org.pac4j.oauth.client.Google2Client
                        key = <span class="string"><span class="delimiter">'</span><span class="content">xxxx.apps.googleusercontent.com</span><span class="delimiter">'</span></span>
                        secret = <span class="string"><span class="delimiter">'</span><span class="content">xxx</span><span class="delimiter">'</span></span>
                        scope = org.pac4j.oauth.client.Google2Client.Google2Scope.EMAIL_AND_PROFILE
                        defaultRoles = [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_USER</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">ROLE_GOOGLE</span><span class="delimiter">'</span></span>]

                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>scope</code> can be from any value of the enum <code>org.pac4j.oauth.client.Google2Client.Google2Scope</code>. But if you use the
default <code>OauthUserDetailsService</code>, you need to use <code>EMAIL_AND_PROFILE</code>. That is because the default implementation
uses the profile ID as the username, and that is only returned by Google if <code>EMAIL_AND_PROFILE</code> scope is used.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_facebook">16.1.1. Facebook</h4>
<div class="paragraph">
<p>Define the following block in your <code>application.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 22. Facebook OAuth sample configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails {
    plugin {
        springsecurity {

            rest {

                oauth {

                    frontendCallbackUrl = { <span class="predefined-type">String</span> tokenValue -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">http://my.frontend-app.com/welcome#token=</span><span class="inline"><span class="inline-delimiter">${</span>tokenValue<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> }

                    facebook {

                        client = org.pac4j.oauth.client.FacebookClient
                        key = <span class="string"><span class="delimiter">'</span><span class="content">xxx</span><span class="delimiter">'</span></span>
                        secret = <span class="string"><span class="delimiter">'</span><span class="content">yyy</span><span class="delimiter">'</span></span>
                        scope = <span class="string"><span class="delimiter">'</span><span class="content">email,user_location</span><span class="delimiter">'</span></span>
                        fields = <span class="string"><span class="delimiter">'</span><span class="content">id,name,first_name,middle_name,last_name,username</span><span class="delimiter">'</span></span>
                        defaultRoles = [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_USER</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">ROLE_FACEBOOK</span><span class="delimiter">'</span></span>]
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>scope</code> is a comma-separated list, <strong>without blanks</strong>, of Facebook permissions. See the
<a href="https://developers.facebook.com/docs/reference/login/">Facebook documentation</a> for more details.</p>
</div>
<div class="paragraph">
<p><code>fields</code> may contain a comma-separated list, <strong>without blanks</strong>, of
<a href="https://developers.facebook.com/docs/graph-api/reference/user/">user fields</a>.</p>
</div>
<div class="paragraph">
<p>Both <code>scope</code> and <code>fields</code> are optional, but it&#8217;s highly recommendable to fine tune those lists so you don&#8217;t ask for
information you don&#8217;t need.</p>
</div>
</div>
<div class="sect3">
<h4 id="_twitter">16.1.2. Twitter</h4>
<div class="paragraph">
<p>Define the following block in your <code>application.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 23. Twitter OAuth sample configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails {
    plugin {
        springsecurity {

            rest {

                oauth {

                    frontendCallbackUrl = { <span class="predefined-type">String</span> tokenValue -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">http://my.frontend-app.com/welcome#token=</span><span class="inline"><span class="inline-delimiter">${</span>tokenValue<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> }

                    twitter {

                        client = org.pac4j.oauth.client.TwitterClient
                        key = <span class="string"><span class="delimiter">'</span><span class="content">xxx</span><span class="delimiter">'</span></span>
                        secret = <span class="string"><span class="delimiter">'</span><span class="content">yyy</span><span class="delimiter">'</span></span>
                        defaultRoles = [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_USER</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">ROLE_TWITTER</span><span class="delimiter">'</span></span>]
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no additional configuration for Twitter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cas_central_authentication_service">16.1.3. CAS (Central Authentication Service)</h4>
<div class="paragraph">
<p>Define the following block in your <code>application.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 24. CAS sample configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails {
    plugin {
        springsecurity {

            rest {

                oauth {

                    frontendCallbackUrl = { <span class="predefined-type">String</span> tokenValue -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">http://my.frontend-app.com/welcome#token=</span><span class="inline"><span class="inline-delimiter">${</span>tokenValue<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> }

                    cas {

                        client = org.pac4j.cas.client.CasClient
                        configuration = <span class="keyword">new</span> org.pac4j.cas.config.CasConfiguration(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://my.cas-server.com/cas/login</span><span class="delimiter">&quot;</span></span>)
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set <code>configuration</code> to an instance of <code>org.pac4j.cas.config.CasConfiguration</code> passing the login URL of your CAS server as the argument of the constructor.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="debugging">17. Debugging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you need debug information, you can specify the following entries in <code>logback.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 25. Logging setup</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">logger(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.security</span><span class="delimiter">&quot;</span></span>, DEBUG, [<span class="string"><span class="delimiter">'</span><span class="content">STDOUT</span><span class="delimiter">'</span></span>], <span class="predefined-constant">false</span>)
logger(<span class="string"><span class="delimiter">&quot;</span><span class="content">grails.plugin.springsecurity</span><span class="delimiter">&quot;</span></span>, DEBUG, [<span class="string"><span class="delimiter">'</span><span class="content">STDOUT</span><span class="delimiter">'</span></span>], <span class="predefined-constant">false</span>)
logger(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.pac4j</span><span class="delimiter">&quot;</span></span>, DEBUG, [<span class="string"><span class="delimiter">'</span><span class="content">STDOUT</span><span class="delimiter">'</span></span>], <span class="predefined-constant">false</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="faq">18. Frequently Asked Questions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_why_this_token_based_implementation_cant_i_use_http_basic_authentication">18.1. Why this token-based implementation? Can&#8217;t I use HTTP basic authentication?</h3>
<div class="paragraph">
<p>In theory you can. The only restriction to be truly stateless is to not use HTTP sessions at all. So if you go with
basic authentication, you need to transfer the credentials back and forth every time.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s think about that. Keep in mind that your frontend is a pure HTML/Javascript application, consuming a REST API
from the Grails side. So the first time, the Javascript application will make an API query and will receive a 401 response
indicating that authentication is required. Then you present the user a form to enter credentials, you grab them, <strong>encode</strong>
them with Base64 and in the next request, you send an HTTP header like <code>Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</code>.</p>
</div>
<div class="paragraph">
<p>Now remember you are doing RESTful application, so the session state is maintained in the client. That means that you
would need to store that Base64 encoded string somewhere: cookies? HTML5 local storage? In any case, they are accessible
using browser tools. And that&#8217;s the point: there is a huge security risk because Base64 it&#8217;s not encryption, just encoding.
And it can be easily decoded.</p>
</div>
<div class="paragraph">
<p>You could argue that someone can access the token in the browser. Yes, but having the token will not allow him to obtain
user&#8217;s credentials. The tokens are just not decodable. And they can be revoked if necessary.</p>
</div>
<div class="paragraph">
<p>Fortunately for you, a token-based solution is not a magic idea that I only got; it&#8217;s actually a specification:
<a href="http://tools.ietf.org/html/rfc6750">RFC 6750 - The OAuth 2.0 Authorization Framework: Bearer Token Usage</a>.</p>
</div>
<div class="paragraph">
<p>Moreover, if you use tokens, you have the chance to implement expiration policies.</p>
</div>
<div class="paragraph">
<p>A couple of link with further explanations on the token-based flow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.jamesward.com/2013/05/13/securing-single-page-apps-and-rest-services" class="bare">http://www.jamesward.com/2013/05/13/securing-single-page-apps-and-rest-services</a></p>
</li>
<li>
<p><a href="http://blog.brunoscopelliti.com/authentication-to-a-restful-web-service-in-an-angularjs-web-app" class="bare">http://blog.brunoscopelliti.com/authentication-to-a-restful-web-service-in-an-angularjs-web-app</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_why_cant_the_api_be_secured_with_oauth">18.2. Why can&#8217;t the API be secured with OAuth?</h3>
<div class="paragraph">
<p><a href="http://tools.ietf.org/html/rfc6749">RFC 6749 - OAuth 2.0</a> specification does cover this scenario in what they call
"public clients":</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Clients incapable of maintaining the confidentiality of their credentials (e.g., clients executing on the device used by the
resource owner, such as an installed native application or a web browser-based application), and incapable of secure client
authentication via any other means.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The OAuth 2.0 specification supports public clients with the implicit grant. This plugin supports that by default when
you delegate the authentication to another OAuth provider. If it&#8217;s you who are authenticating the users
(via DB, LDAP, etc), the token-based flow of this plugin is <em>OAuth-ish</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_why_you_didnt_use_any_of_the_existing_oauth_plugins_why_pac4j">18.3. Why you didn&#8217;t use any of the existing OAuth plugins? Why pac4j?</h3>
<div class="paragraph">
<p>I&#8217;m aware of plugins like <a href="http://grails.org/plugin/oauth">OAuth</a> and
<a href="http://grails.org/plugin/spring-security-oauth">Spring Security OAuth</a>, but all of them rely on Spring Security Core&#8217;s
way of using HTTP sessions. So not acceptable.</p>
</div>
<div class="paragraph">
<p>I chose pac4j because:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>They support major OAuth 2.0 providers out-of-the-box, whereas Scribe does not.</p>
</li>
<li>
<p>It&#8217;s deadly simple and works just fine.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>I&#8217;m also aware of a pac4j-spring-security module. See my previous response on HTTP sessions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_project_history">18.4. Project History</h3>
<div class="paragraph">
<p>Originally this plugin was written by Alvaro Sanchez-Mariscal (<a href="https://twitter.com/alvaro_sanchez">Twitter</a>).  It is currently maintained by the Grails Stewards.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 6.0.0-SNAPSHOT<br>
Last updated 2024-10-22 13:36:39 UTC
</div>
</div>
</body>
</html>